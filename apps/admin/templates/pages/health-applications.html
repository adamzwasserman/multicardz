{% extends "base_admin.html" %}

{% block title %}multicardz admin - Application Health{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header" style="margin-bottom: 32px;">
    <h1 style="margin: 0; font-size: 2rem; font-weight: 700; color: var(--color-text-primary);">
        Application Health Monitoring
    </h1>
    <p style="margin: 8px 0 0; color: var(--color-text-secondary); font-size: 1.1rem;">
        Real-time monitoring of all multicardz applications and services
    </p>
</div>

<!-- Health Overview Grid -->
<div class="admin-dashboard-grid">
    <!-- User Site Health -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">üåê User Site</h3>
            <span class="status-indicator healthy">Healthy</span>
        </div>
        <div class="admin-card-body">
            <div class="metric-grid">
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-status-healthy);">99.9%</div>
                    <div class="metric-label">Uptime</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-metric-low);">32ms</div>
                    <div class="metric-label">Response</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-action-primary);">89</div>
                    <div class="metric-label">Active Users</div>
                </div>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: var(--color-admin-accent); border-radius: 6px;">
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                    <strong>Status:</strong> All drag-drop operations functional<br>
                    <strong>Last Deploy:</strong> 2 hours ago (v2.1.4)<br>
                    <strong>Memory:</strong> 8.2MB (target: <15MB) ‚úÖ
                </div>
            </div>
        </div>
    </div>

    <!-- Set Operations Service -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">‚ö° Set Operations</h3>
            <span class="status-indicator healthy">Optimal</span>
        </div>
        <div class="admin-card-body">
            <div class="metric-grid">
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-status-healthy);">2.1ms</div>
                    <div class="metric-label">Avg Time</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-action-primary);">98.7%</div>
                    <div class="metric-label">Cache Hit</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-metric-low);">1,247</div>
                    <div class="metric-label">Ops/min</div>
                </div>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: var(--color-admin-accent); border-radius: 6px;">
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                    <strong>Short-circuit:</strong> Working (<5ms) ‚úÖ<br>
                    <strong>Roaring Bitmaps:</strong> Available ‚úÖ<br>
                    <strong>Processing Mode:</strong> Regular/Parallel
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Service -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">üîê Authentication</h3>
            <span class="status-indicator healthy">Secure</span>
        </div>
        <div class="admin-card-body">
            <div class="metric-grid">
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-status-healthy);">100%</div>
                    <div class="metric-label">Success Rate</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-metric-low);">156ms</div>
                    <div class="metric-label">Auth Time</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-action-primary);">342</div>
                    <div class="metric-label">Sessions</div>
                </div>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: var(--color-admin-accent); border-radius: 6px;">
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                    <strong>MFA:</strong> 94% adoption rate<br>
                    <strong>Failed Logins:</strong> 0 (last 24h) ‚úÖ<br>
                    <strong>Session Timeout:</strong> 8 hours
                </div>
            </div>
        </div>
    </div>

    <!-- Database Service -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">üóÑÔ∏è Database</h3>
            <span class="status-indicator warning">Load Warning</span>
        </div>
        <div class="admin-card-body">
            <div class="metric-grid">
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-status-warning);">78%</div>
                    <div class="metric-label">CPU Usage</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-metric-medium);">45ms</div>
                    <div class="metric-label">Query Time</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: var(--color-action-primary);">23</div>
                    <div class="metric-label">Connections</div>
                </div>
            </div>
            <div style="margin-top: 16px; padding: 12px; background: color-mix(in srgb, var(--color-status-warning) 10%, transparent); border-radius: 6px;">
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                    <strong>‚ö†Ô∏è Alert:</strong> High CPU usage detected<br>
                    <strong>Recommendation:</strong> Scale horizontally<br>
                    <strong>Last Backup:</strong> 4 hours ago ‚úÖ
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Service Dependencies Map -->
<div class="admin-card" style="margin-bottom: 32px;">
    <div class="admin-card-header">
        <h3 class="admin-card-title">Service Dependencies</h3>
        <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
            Spatial representation of service interconnections
        </div>
    </div>
    <div class="admin-card-body">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; align-items: center;">
            <!-- User Site -->
            <div style="text-align: center;">
                <div style="width: 80px; height: 80px; margin: 0 auto 12px; background: var(--color-status-healthy); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">üåê</div>
                <div style="font-weight: 600;">User Site</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Frontend</div>
            </div>

            <!-- Set Operations (Center) -->
            <div style="text-align: center;">
                <div style="width: 100px; height: 100px; margin: 0 auto 12px; background: var(--color-admin-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">‚ö°</div>
                <div style="font-weight: 600;">Set Operations</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Core Engine</div>
            </div>

            <!-- Admin Site -->
            <div style="text-align: center;">
                <div style="width: 80px; height: 80px; margin: 0 auto 12px; background: var(--color-admin-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">üë®‚Äçüíº</div>
                <div style="font-weight: 600;">Admin Site</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Management</div>
            </div>
        </div>

        <!-- Second Row -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; align-items: center; margin-top: 32px;">
            <!-- Authentication -->
            <div style="text-align: center;">
                <div style="width: 70px; height: 70px; margin: 0 auto 12px; background: var(--color-status-healthy); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">üîê</div>
                <div style="font-weight: 600;">Authentication</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Security</div>
            </div>

            <!-- Database -->
            <div style="text-align: center;">
                <div style="width: 70px; height: 70px; margin: 0 auto 12px; background: var(--color-status-warning); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">üóÑÔ∏è</div>
                <div style="font-weight: 600;">Database</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Storage</div>
            </div>

            <!-- Storage -->
            <div style="text-align: center;">
                <div style="width: 70px; height: 70px; margin: 0 auto 12px; background: var(--color-status-healthy); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">üíæ</div>
                <div style="font-weight: 600;">Storage</div>
                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">Files</div>
            </div>
        </div>

        <!-- Connection Lines (Visual Representation) -->
        <div style="margin-top: 24px; padding: 16px; background: var(--color-admin-accent); border-radius: 8px; text-align: center;">
            <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                <strong>Service Communication Flow:</strong><br>
                User Site ‚Üî Set Operations ‚Üî Database<br>
                Authentication ‚Üí All Services<br>
                Admin Site ‚Üí Monitoring ‚Üí All Services
            </div>
        </div>
    </div>
</div>

<!-- Real-time Metrics -->
<div class="admin-card">
    <div class="admin-card-header">
        <h3 class="admin-card-title">Real-time Performance Metrics</h3>
        <button class="btn btn-outline" onclick="refreshMetrics()">üîÑ Refresh</button>
    </div>
    <div class="admin-card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <div class="metric-item">
                <div class="metric-value" style="color: var(--color-status-healthy);">
                    <span id="requestsPerSecond">247</span>/s
                </div>
                <div class="metric-label">Requests</div>
                <div class="metric-change positive">+12% vs last hour</div>
            </div>

            <div class="metric-item">
                <div class="metric-value" style="color: var(--color-metric-low);">
                    <span id="averageResponseTime">45</span>ms
                </div>
                <div class="metric-label">Response Time</div>
                <div class="metric-change positive">-8ms improvement</div>
            </div>

            <div class="metric-item">
                <div class="metric-value" style="color: var(--color-action-primary);">
                    <span id="errorRate">0.1</span>%
                </div>
                <div class="metric-label">Error Rate</div>
                <div class="metric-change positive">Target: <1%</div>
            </div>

            <div class="metric-item">
                <div class="metric-value" style="color: var(--color-status-healthy);">
                    <span id="throughput">1,247</span>
                </div>
                <div class="metric-label">Operations/min</div>
                <div class="metric-change positive">+89 vs baseline</div>
            </div>
        </div>

        <!-- Live Status Indicators -->
        <div style="margin-top: 24px; display: flex; flex-wrap: wrap; gap: 12px;">
            <div class="status-indicator healthy">
                <span>Set Operations: 2.1ms avg</span>
            </div>
            <div class="status-indicator healthy">
                <span>Cache: 98.7% hit rate</span>
            </div>
            <div class="status-indicator warning">
                <span>Database: 78% CPU usage</span>
            </div>
            <div class="status-indicator healthy">
                <span>Memory: <15MB target met</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Refresh metrics functionality
function refreshMetrics() {
    // Simulate real-time metric updates
    const rps = document.getElementById('requestsPerSecond');
    const responseTime = document.getElementById('averageResponseTime');
    const errorRate = document.getElementById('errorRate');
    const throughput = document.getElementById('throughput');

    // Simulate slight variations in metrics
    if (rps) rps.textContent = Math.floor(Math.random() * 50) + 220;
    if (responseTime) responseTime.textContent = Math.floor(Math.random() * 20) + 35;
    if (errorRate) errorRate.textContent = (Math.random() * 0.3).toFixed(1);
    if (throughput) throughput.textContent = Math.floor(Math.random() * 200) + 1150;

    // Show refresh feedback
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '‚úÖ Updated';
    button.disabled = true;

    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
    }, 1500);
}

// Auto-refresh every 30 seconds
setInterval(refreshMetrics, 30000);
</script>
{% endblock %}